## 本地交互数据留存声明（目的、边界与治理原则）

### 初心与目的
- **求真与可复现**: 交互数据记录的是“问题—推理—修复”的真实轨迹，用于复盘、验证与长期改进。
- **方法论沉淀**: 从真实交互中提炼“低级组件诚实原则”“逻辑矛盾追溯法”等可复用的方法论，指导系统迭代。
- **系统演进的后路**: 中心化框架趋势是丢弃交互数据，我们保留本地副本，避免认知资产被系统设计疏漏冲刷掉。

### 行为边界（明确不做与只做的范围）
- **只在本地持久化**: 交互数据仅写入本机 `data/interactions/*.jsonl`，不上传、不对外同步、不嵌入第三方SDK。
- **用途受限**: 仅用于复盘、审计、方法论沉淀与系统改进；不用于商业化二次利用，不用于训练第三方模型。
- **最小化与脱敏**: 仅记录必要元数据与摘要；对可能出现的敏感信息执行脱敏或哈希处理，避免原文暴露。
- **用户可控**: 提供本地导出与删除能力；开启/关闭记录由用户显式控制，默认遵循“明确同意原则”。

### 数据范围（记录内容的类型与边界）
- **事件元信息**: `path`、`method`、`content_type`、`timestamp`、`session_id`（如有）。
- **请求摘要**: 关键入参的非敏感摘要（如文件名、消息长度/类型），避免记录全文私密内容。
- **响应摘要**: 成功/失败状态、错误类型与堆栈摘要（作为“代码真相”的证据锚点）。
- **版本快照（可选）**: 相关组件版本、配置标识，用于问题复现与对比分析。

### 存储策略（实现与结构）
- **目录与格式**: 本地目录 `data/interactions/`，文件按日滚动 `YYYYMMDD.jsonl`，一行一事件，便于检索/归档。
- **接入点**: 已在 `/api/upload`、`/api/message`、`/api/agent-template/message`、`/api/chatroom/message` 接入记录。
- **配置项**: 由 `config/system_config.py` 管理：
  - `LOG_INTERACTIONS = True`
  - `INTERACTION_LOG_DIR = DATA_DIR / "interactions"`
  - `INTERACTION_RETENTION_DAYS = 30`

### 传输与访问（限制与承诺）
- **零外传**: 不进行网络传输，不连接外部服务；交互数据仅在本地读写。
- **访问控制**: 仅运行进程访问；文件加锁与权限控制，防止非授权读取。
- **透明可审计**: 保留操作审计日志（读/写/删时间与主体），确保治理链条清晰。

### 用户权利（选择与控制）
- **启用/停用**: 前端提供“本地交互日志开关”，默认关闭，用户开启后显示“记录中”状态提示。
- **导出/删除**: 提供本地导出与按会话/时间范围删除的能力，用户自主管理数据副本。
- **可见性**: 文档与配置清晰展示数据范围、用途与保留期限，避免误解。

### 保留与归档
- **保留期限**: 默认保留 30 天，可配置。
- **归档策略**: 超期数据加密压缩归档或本地删除；归档仅本机可读，避免外传。

### 合规与风险说明
- **与“数据权盗取”区分**: 我们不抓取、不过度采集、不外传、不商业化；仅本地最小化记录，为求真与复现服务。
- **目的正当**: 记录交互是为了验证系统行为、沉淀方法论，保障“完整性校验”“二级报错”等协议能真实落地。
- **风险应对**: 提供显式开关、用途声明、脱敏处理、用户控制、审计日志与保留策略，降低被误判风险。

### 方法论价值（为何必要）
- **代码诚实**: 低级组件只有“正常/异常”二态，交互数据能把“代码真相”转化为可复用的诊断知识。
- **逻辑一致性**: 通过事件轨迹对比输入/输出与规则执行，及时发现“规则不一致”“统计矛盾”等系统级问题。
- **长期演进**: 交互数据是认知资产，可持续增强检索、工具编排、提示词与架构优化。

### 版本与变更
- **当前版本**: v1.0（启用本地 JSONL 记录，接入上传/消息/智能体/聊天室四类端点）
- **后续计划**: 增加前端开关与导出/删除接口、脱敏管线与审计日志、夜间自动归档与方法论提炼任务。

### 结语
- 我们选择在本地保留交互数据，是为了守住“求真、复现、演进”的初心，补全中心化框架的系统性疏漏；
- 我们明确边界、强调透明、保障用户控制，确保这份认知资产在正当与可控的轨道上发挥长期价值。
