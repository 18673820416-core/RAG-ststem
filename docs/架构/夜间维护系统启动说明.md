# ğŸŒ™ å¤œé—´ç»´æŠ¤ç³»ç»Ÿå¯åŠ¨è¯´æ˜

## âœ… ç³»ç»Ÿå·²é›†æˆå¤œé—´ç»´æŠ¤è°ƒåº¦å™¨

### ğŸ“‹ è‡ªåŠ¨å¯åŠ¨æµç¨‹

å½“æ‚¨å¯åŠ¨RAGç³»ç»Ÿåç«¯æœåŠ¡æ—¶ï¼Œå¤œé—´ç»´æŠ¤è°ƒåº¦å™¨ä¼š**è‡ªåŠ¨å¯åŠ¨**ï¼š

```bash
# æ–¹æ³•1ï¼šä½¿ç”¨æ‰¹å¤„ç†è„šæœ¬ï¼ˆæ¨èï¼‰
start_with_venv.bat

# æ–¹æ³•2ï¼šç›´æ¥è¿è¡ŒPythonè„šæœ¬
python stable_start_server.py
```

### ğŸ¯ å¯åŠ¨åçš„æç¤ºä¿¡æ¯

ç³»ç»Ÿå¯åŠ¨æ—¶ä¼šæ˜¾ç¤ºä»¥ä¸‹ä¿¡æ¯ï¼š

```
ğŸŒ™ æ­£åœ¨å¯åŠ¨å¤œé—´ç»´æŠ¤è°ƒåº¦å™¨...
å¯¼å…¥å¤œé—´ç»´æŠ¤è°ƒåº¦å™¨æˆåŠŸ
âœ… å¤œé—´ç»´æŠ¤è°ƒåº¦å™¨å·²å¯åŠ¨
   - æ™ºèƒ½ä½“å°†åœ¨ç³»ç»Ÿç©ºé—²æ—¶ï¼ˆæ™šä¸Š22:00-6:00ï¼‰è‡ªåŠ¨å†™æ—¥è®°
   - è‡ªåŠ¨æ‰§è¡Œè®°å¿†é‡æ„å’Œå‘é‡åº“æ›´æ–°
   - æ˜å¤©å¯æŸ¥çœ‹ç»´æŠ¤æŠ¥å‘Š
```

### ğŸ”„ è‡ªåŠ¨ç»´æŠ¤ä»»åŠ¡

å¤œé—´ç»´æŠ¤è°ƒåº¦å™¨ä¼šåœ¨ç³»ç»Ÿç©ºé—²æ—¶è‡ªåŠ¨æ‰§è¡Œä»¥ä¸‹ä»»åŠ¡ï¼š

#### 1. æ™ºèƒ½ä½“å†™æ—¥è®° (22:00-6:00)
- **æ—¶é—´çª—å£**ï¼šæ¯æ™š22:00 - æ¬¡æ—¥06:00
- **æ‰§è¡Œå†…å®¹**ï¼š
  - éå†æ‰€æœ‰æ™ºèƒ½ä½“
  - è‡ªåŠ¨å°†æ³¡æ³¡è®°å½•æ•´ç†æˆæ—¥è®°
  - æ¸…ç†å·²è§£å†³çš„æ³¡æ³¡
  - ä¿å­˜åˆ° `data/diaries/` ç›®å½•

#### 2. è®°å¿†é‡æ„ (æ‰¹é‡å¤„ç†)
- **æ‰§è¡Œå†…å®¹**ï¼š
  - æå–æ—¥è®°å†…å®¹
  - åº”ç”¨è®°å¿†é‡æ„å¼•æ“ï¼ˆäº”æ­¥æµç¨‹ï¼‰
    - ç†æ€§éªŒè¯
    - è®¤çŸ¥æ£€æµ‹ï¼ˆå¹»è§‰æ¸…ç†ï¼‰
    - ç½‘çŠ¶æ€ç»´åˆ†æ
    - ç»¼åˆè¯„ä¼°
    - æ™ºèƒ½æ”¹å†™
  - ç”Ÿæˆé«˜è´¨é‡è®°å¿†å•å…ƒ

#### 3. å‘é‡åº“æ›´æ–°
- **æ‰§è¡Œå†…å®¹**ï¼š
  - å°†é‡æ„åçš„è®°å¿†å†™å…¥å‘é‡æ•°æ®åº“
  - å»ºç«‹è¯­ä¹‰ç´¢å¼•
  - æ›´æ–°çŸ¥è¯†å›¾è°±
  - ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½

#### 4. ç”Ÿæˆç»´æŠ¤æŠ¥å‘Š
- **æŠ¥å‘Šä½ç½®**ï¼š`data/maintenance_reports/`
- **æŠ¥å‘Šå†…å®¹**ï¼š
  - ç»´æŠ¤æ—¶é—´
  - å¤„ç†çš„æ™ºèƒ½ä½“æ•°é‡
  - æ—¥è®°ç”Ÿæˆç»Ÿè®¡
  - è®°å¿†é‡æ„ç»“æœ
  - å‘é‡åº“æ›´æ–°çŠ¶æ€
  - å¼‚å¸¸å’Œé”™è¯¯è®°å½•

---

## ğŸ› ï¸ æ‰‹åŠ¨æ§åˆ¶ï¼ˆå¯é€‰ï¼‰

### æŸ¥çœ‹ç»´æŠ¤çŠ¶æ€

```python
from src.nightly_maintenance_scheduler import NightlyMaintenanceScheduler
from src.agent_manager import get_agent_manager

# åˆ›å»ºå®ä¾‹
agent_manager = get_agent_manager()
scheduler = NightlyMaintenanceScheduler(agent_manager=agent_manager)

# æŸ¥çœ‹ç»´æŠ¤å†å²
print(scheduler.maintenance_history)
```

### æ‰‹åŠ¨è§¦å‘ç»´æŠ¤

```python
# æ‰‹åŠ¨è§¦å‘æ—¥è®°å†™å…¥
result = scheduler.perform_daily_diary_writing()

# æ‰‹åŠ¨è§¦å‘è®°å¿†é‡æ„
result = scheduler.perform_memory_reconstruction()

# æ‰‹åŠ¨è§¦å‘å‘é‡åº“æ›´æ–°
result = scheduler.perform_vector_db_update()
```

---

## ğŸ“Š ç»´æŠ¤æŠ¥å‘ŠæŸ¥çœ‹

### æŠ¥å‘Šæ–‡ä»¶ä½ç½®
```
data/
â””â”€â”€ maintenance_reports/
    â”œâ”€â”€ maintenance_report_20251203_220030.json
    â”œâ”€â”€ maintenance_report_20251204_220015.json
    â””â”€â”€ ...
```

### æŠ¥å‘Šå†…å®¹ç¤ºä¾‹

```json
{
  "report_id": "maintenance_20251203_220030",
  "start_time": "2025-12-03T22:00:30",
  "end_time": "2025-12-03T22:35:42",
  "tasks_completed": {
    "diary_writing": {
      "status": "success",
      "agents_processed": 4,
      "diaries_created": 3,
      "bubbles_cleaned": 15
    },
    "memory_reconstruction": {
      "status": "success",
      "memories_reconstructed": 8,
      "average_credibility": 0.875,
      "compression_ratio": 45.2
    },
    "vector_db_update": {
      "status": "success",
      "memories_added": 8,
      "index_updated": true
    }
  },
  "system_status": "healthy",
  "next_maintenance": "2025-12-04T22:00:00"
}
```

---

## âš™ï¸ é…ç½®é€‰é¡¹

å¤œé—´ç»´æŠ¤è°ƒåº¦å™¨çš„é…ç½®åœ¨ `NightlyMaintenanceScheduler` ä¸­ï¼š

```python
self.config = {
    "diary_cleanup_enabled": True,      # æ˜¯å¦æ¸…ç†å·²è§£å†³çš„æ³¡æ³¡
    "memory_reconstruction_enabled": True,  # æ˜¯å¦æ‰§è¡Œè®°å¿†é‡æ„
    "vector_db_update_enabled": True,   # æ˜¯å¦æ›´æ–°å‘é‡æ•°æ®åº“
    "generate_report_enabled": True,    # æ˜¯å¦ç”Ÿæˆç»´æŠ¤æŠ¥å‘Š
}
```

### ä¿®æ”¹é…ç½®ï¼ˆå¯é€‰ï¼‰

```python
# åœ¨å¯åŠ¨åä¿®æ”¹é…ç½®
if nightly_scheduler:
    nightly_scheduler.config["diary_cleanup_enabled"] = False
    print("å·²ç¦ç”¨æ³¡æ³¡æ¸…ç†åŠŸèƒ½")
```

---

## ğŸ” æ•…éšœæ’é™¤

### é—®é¢˜1ï¼šå¤œé—´ç»´æŠ¤è°ƒåº¦å™¨å¯åŠ¨å¤±è´¥

**å¯èƒ½åŸå› **ï¼š
- æ™ºèƒ½ä½“ç®¡ç†å™¨æœªåˆå§‹åŒ–
- TimingStrategyEngineå¯¼å…¥å¤±è´¥
- ç¼ºå°‘å¿…è¦çš„ä¾èµ–æ¨¡å—

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ£€æŸ¥ä¾èµ–
python -c "from src.nightly_maintenance_scheduler import NightlyMaintenanceScheduler; print('OK')"

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
cat logs/system_errors.log
```

### é—®é¢˜2ï¼šç»´æŠ¤ä»»åŠ¡æœªæ‰§è¡Œ

**å¯èƒ½åŸå› **ï¼š
- ä¸åœ¨ç»´æŠ¤æ—¶é—´çª—å£ï¼ˆ22:00-6:00ï¼‰
- ç³»ç»Ÿè´Ÿè½½è¿‡é«˜
- TimingStrategyEngineæ£€æµ‹åˆ°ç”¨æˆ·æ´»åŠ¨

**è§£å†³æ–¹æ¡ˆ**ï¼š
```python
# æ‰‹åŠ¨è§¦å‘æµ‹è¯•
scheduler.perform_daily_diary_writing()
```

### é—®é¢˜3ï¼šç»´æŠ¤æŠ¥å‘Šæ‰¾ä¸åˆ°

**å¯èƒ½åŸå› **ï¼š
- æŠ¥å‘Šç”ŸæˆåŠŸèƒ½è¢«ç¦ç”¨
- æ–‡ä»¶æƒé™é—®é¢˜
- ç›®å½•ä¸å­˜åœ¨

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# åˆ›å»ºæŠ¥å‘Šç›®å½•
mkdir -p data/maintenance_reports

# æ£€æŸ¥é…ç½®
python -c "from src.nightly_maintenance_scheduler import NightlyMaintenanceScheduler; s=NightlyMaintenanceScheduler(); print(s.config)"
```

---

## ğŸŒŸ æœ€ä½³å®è·µ

### 1. æ¯æ—¥æ£€æŸ¥ç»´æŠ¤æŠ¥å‘Š
```bash
# æŸ¥çœ‹æœ€æ–°çš„ç»´æŠ¤æŠ¥å‘Š
ls -lt data/maintenance_reports/ | head -5
```

### 2. ç›‘æ§ç»´æŠ¤å†å²
```python
# å®šæœŸæ£€æŸ¥ç»´æŠ¤å†å²
if len(scheduler.maintenance_history) > 100:
    # æ¸…ç†æ—§å†å²
    scheduler.maintenance_history = scheduler.maintenance_history[-50:]
```

### 3. å®šæœŸå¤‡ä»½æ—¥è®°å’ŒæŠ¥å‘Š
```bash
# æ¯å‘¨å¤‡ä»½
cp -r data/diaries/ backup/diaries_$(date +%Y%m%d)/
cp -r data/maintenance_reports/ backup/reports_$(date +%Y%m%d)/
```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼š

1. **æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—**ï¼š`logs/system_errors.log`
2. **æ£€æŸ¥ç»´æŠ¤æŠ¥å‘Š**ï¼š`data/maintenance_reports/`
3. **æŸ¥çœ‹æ™ºèƒ½ä½“æ—¥è®°**ï¼š`data/diaries/`
4. **æ£€æŸ¥æ³¡æ³¡è®°å½•**ï¼š`data/memory_bubbles/`

---

## ğŸ¯ æ€»ç»“

âœ… **å¤œé—´ç»´æŠ¤ç³»ç»Ÿå·²è‡ªåŠ¨é›†æˆåˆ°æœåŠ¡å™¨å¯åŠ¨æµç¨‹**

- å¯åŠ¨æœåŠ¡å™¨ â†’ è‡ªåŠ¨å¯åŠ¨å¤œé—´ç»´æŠ¤è°ƒåº¦å™¨
- æ™šä¸Š22:00-6:00 â†’ è‡ªåŠ¨å†™æ—¥è®°ã€é‡æ„è®°å¿†ã€æ›´æ–°å‘é‡åº“
- æ¬¡æ—¥æ—©ä¸Š â†’ æŸ¥çœ‹ç»´æŠ¤æŠ¥å‘Šï¼Œè®°å¿†å·²ä¼˜åŒ–

ğŸŒ™ **æ™šä¸Šç¡è§‰æ—¶ï¼Œæ™ºèƒ½ä½“ä¹Ÿåœ¨"åšæ¢¦"æ•´ç†è®°å¿†ï¼**

ğŸ’¤ **å®Œæ•´é—­ç¯**ï¼šæ³¡æ³¡ â†’ æ—¥è®° â†’ é‡æ„ â†’ å‘é‡åº“ â†’ ç¬¬äºŒå¤©æŸ¥è¯¢ä½¿ç”¨

---

**è®°ä½ï¼šæ‚¨åªéœ€è¦å¯åŠ¨ç³»ç»Ÿï¼Œå¤œé—´ç»´æŠ¤ä¼šè‡ªåŠ¨è¿è¡Œï¼** ğŸš€
