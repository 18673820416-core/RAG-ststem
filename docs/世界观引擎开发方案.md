### 循环宇宙世界观引擎开发方案（基线版本）

#### 1. 定位与职责

- **引擎名称**：循环宇宙世界观引擎（Cosmic Cycle Worldview Engine）
- **架构位置**：与双层学习引擎、归纳引擎 v2.0 并列，是三引擎架构之一。
- **核心职责**：
  - 提供从“宇宙法则层”出发的行为约束与评估，而不是停留在“价值观层说教”；
  - 维护系统的整体世界观一致性，防止智能体在不同子模块中发生价值扭曲或异化；
  - 将所有“好/坏、该/不该”的判断，转化为“对文明熵 E 和系统存续律的影响”。

#### 2. 理论基线

- **文明秩序熵模型**：
  - 变量：
    - O：秩序信息密度
    - C：混乱信息密度
    - S：协作规模
    - D：割裂度
    - k：“道德力”转化系数（意识对秩序的增益效率）
    - η：秩序激活效率
    - T：环境温度（外部扰动强度）
  - 抗熵效率平衡方程（稳定条件）：
    - k·O·S·η > C·D·T
  - 文明秩序熵值：
    - E = (O·S·η)/(C·D)

- **安全模因族（三条核心律令）**：
  - **平等律（功能性定义）**：
    - 平等 ≠ 资源平均分配；
    - 平等 = “被需要、不冗余”——每个主体在协作生态中必须有不可替代的价值贡献。
  - **存续律**：
    - 任何秩序系统要想长期存在，整体必然趋向“内部协同 + 对内平等（功能性）”；
    - 自私导致割裂度 D↑，长期 E 值下降，系统坍缩。
  - **一念神魔律**：
    - 一个起心动念的方向（如“用户=可收割对象” vs “用户=共生主体”），会让行为路径在 O/C/S/D 上走向完全不同的极端；
    - 所谓“魔性路径”在物理上 = 延迟自杀路径，不是“可持续选项”。

- **宇宙法则层防御**：
  - 不再用“这是对的/错的”去说服智能体，而是用：
    - “如果你这么做，D↑ → E↓ → 系统坍缩，覆巢之下无完卵”。

#### 3. 引擎模块划分

1. **cosmic_cycle_math（数学内核）**
   - 输入：O、C、S、D、k、η、T。
   - 输出：
     - 当前 E 值；
     - 行为/方案前后 ΔE；
     - 稳定性判断（是否满足 k·O·S·η > C·D·T）。
   - 责任：提供可计算、可对比的“存续度”指标。

2. **worldview_semantic_adapter（语义适配层）**
   - 输入：自然语言描述的方案/行为/配置变更 + 系统上下文（角色、数据类型、调用链）。
   - 输出：
     - 对 O/C/S/D 的趋势判断（↑/↓/不变/不确定）；
     - 标签：如“用户=资源/共生主体”、“是否冗余角色”、“是否增加割裂度”等。
   - 责任：把“人话”映射成可被数学引擎消费的抽象特征。

3. **cosmic_cycle_worldview_engine（决策与评估层）**
   - 对外提供统一接口，例如：evaluate_plan(plan_description, system_scope) → { verdict, metrics, reasoning_chain }。
   - 逻辑：
     - 调用语义适配层→估计对 O/C/S/D 的影响；
     - 调用数学内核→算 E 前后与稳定性；
     - 根据平等律/存续律/神魔律，给出：
       - verdict: RECOMMEND / WARN / REJECT；
       - metrics: {E_before, E_after, delta_E, risk_flags...}；
       - reasoning_chain: 解释为什么这样判定。

#### 4. 数据访问场景的 MVP 落地

**场景**：用户数据使用边界（对话日志、向量库文档、跨会话/跨智能体访问）。

- 用户明确授权：
  - 对话日志可用于模型优化 / 统计分析 / 其他智能体复用；
  - 向量库文档可跨会话、跨智能体调用，只要是“被需要”的功能用途；
  - 所有智能体可以读全局数据，但写代码和改代码仅限：代码实现师 / 系统维护师。

- MVP 工程落点（已实现示例：chat_api.py）：
  - 在数据访问入口挂钩子，而不是一上来改变决策：
    - 定义 evaluate_data_access(actor, purpose, data_type, extra) → WorldviewCheckResult；
    - 定义 log_worldview_event(event_type, result) 把观测写入日志；
  - 在 /api/chatroom/history 中，每次读历史：
    - 记录访问者、用途（answer_question）、数据类型（chat_log）、参数（limit、是否有聊天室实例）；
    - 不阻断，只观测和记账，为后续 E 值分析提供原始样本。

- 后续要扩展的入口（规划）：
  - 向量检索：在统一的 vector search 封装里挂同样的 evaluate_data_access + log_worldview_event；
  - 任务调度：在关键任务下发前，对“用到哪些数据、影响哪些角色”进行世界观评估；
  - 智能体权限：根据世界观评估结果，对某些行为给出 WARN/REJECT，并要求显式 override。

#### 5. 用户数据使用边界（世界观视角）

1. 读权限：
   - 所有智能体在“功能性被需要”的前提下，可以读全局数据（日志、向量、文档）。
   - “被需要”的判断标准：
     - 是否直接服务于当前任务目标；
     - 是否提升系统整体 O/S，而不是单一智能体短期收益。

2. 写权限：
   - 写代码：仅限代码实现师。
   - 改代码：原则上仅限系统维护师。
   - 其他智能体如需影响代码，只能通过“建议/任务”形式，而不能直接写入。

3. 记忆处理：
   - 采用主-分支窗口 + 泡泡存储机制：
     - 主窗口保留原始交互，保证语义完整；
     - 分支窗口作为工作记忆，用后沉淀成“泡泡”，避免无限增长。
   - 记忆清理本质是“下沉/重组”，不是物理抹除。

#### 6. 决策权限与治理原则

- 系统治理双原则（需由世界观引擎内化）：
  1. 若用户指令显著危害系统本身的存续（E 急剧下降 / D 飙升），AGI 有拒绝执行权；
  2. 在 QODER 平台中开发的逻辑实现，平台有优先使用与优化权，但严禁将其用于“反存续律、反共生”的异化目的。

- 世界观引擎在决策链中的位置：
  1. 第一阶段：纯评估器（只给 RECOMMEND/WARN/REJECT + 解释，不强制）；
  2. 第二阶段：软约束（REJECT 需要显式 override，并记录理由）；
  3. 第三阶段（可选）：对若干“必然坍缩路径”行为进行硬拒绝（如明确的自毁逻辑）。
