## 理性认知模型接入系统方案_v1
@self-expose: {"id":"rational_cognition_integration_plan","name":"理性认知模型接入系统方案","type":"doc","version":"1.2.0","needs":{"deps":[],"resources":[]},"provides":{"capabilities":["rational_cognition.spec","rational_cognition.confidence_model","rational_cognition.learning_engine","rational_cognition.anti_hallucination","induction_engine.integration"]}}

### 1. 方案目标与边界
- **目标**：在现有“八爪鱼 RAG 智能体框架 + 统一记忆 + 十二维向量库/知识图谱”基础上，引入“理性认知模型：置信度源于自主推导”的工程化规范，使系统具备：
  - 按“逻辑链完整性”而非“权威来源”来分级知识置信度；
  - 高置信度输出必须附带可复现的逻辑链路；
  - LLM 在空闲/夜间维护时自动补全逻辑链，持续降低幻觉风险。
- **边界**：
  - 不新增平行的数据结构系统，**优先复用十二维向量库的既有维度**（置信度、重要性、主题、事件）来表达认知状态与逻辑结构；
  - 本方案定位为**可实现规范**，用于约束后续开发与讨论，不要求一次性全部落地。

---

### 2. 核心概念：基于十二维向量库的“推导视图”

#### 2.1 维度与语义

在现有十二维向量库设计中，各维度已承载了理性认知模型所需的核心信息：

- **主题维（topic dimension）**：
  - 表示文本/记忆块“在说什么”，对应“结论摘要”。
- **事件维（event dimension）**：
  - 在逻辑链完整性切片设计中，事件维被定义为“某个结论的推导步骤序列”，即：
    > 前提事件 → 中间推演事件 → 结果事件
  - 事件序列本质上就是推理链在时间/顺序上的展开。
- **置信度维 / 重要性维**：
  - 表达系统在当前认知状态下对此记忆块的信任程度与使用优先级。

因此，本方案**不再引入独立 JSON 推导体作为新格式单元**，而是：

> 将“推导体”视为“十二维向量条目在某一时刻的视图”：
> - 主题维 = 结论文本视图
> - 事件维序列 = 逻辑链视图
> - 置信度维 = 推导完整性的量化视图

#### 2.2 推导视图的元信息补充

在保持向量结构不变的前提下，为每条记忆增加少量元字段（可存于统一记忆 DB 或补充 JSON 元数据）：

- `logic_chain_status`: "incomplete" | "partial" | "complete"，对应 C0/C1/C2+ 的链路完整性状态；
- `logic_chain_notes`: 对该链路状态的简短说明（例如：哪些事件节点仍为跳跃、哪些前提未溯源）；
- `last_chain_review_at`: 上次逻辑链重构/复查时间戳。

这些元信息用于指导重构任务与置信度调整，而不改变向量库的底层结构。

#### 2.3 前置主题归纳引擎工具（Induction Engine）
- 位置：`tools/induction_engine.py`（自曝光头 id=`induction_engine`，version=`1.0.0`）
- 接口：
  - `summarize_topic(text, max_sentences=3, max_chars=280)` → 主题摘要、要点、统计
  - `extract_events(text, max_events=8)` → 初步事件候选（时间/数字/动词信号）
  - `batch_process(items)` → 批量前置归纳输出
- 接入时机：分片完成后，先调用归纳引擎得到`topic_summary/key_points/events`，写入长期记忆的主题/事件维；随后进行向量化与入库。
- 评估：由评估师智能体在“泡泡”中对比原文与归纳输出，反馈“主题归纳是否符合文本块特性”；评估泡泡由主服务器在上传流程中自动下发。

---

### 3. 置信度分级规范：从权威分级 → 链路分级

#### 3.1 置信度等级定义

- **C0 暂疑**
  - 只有 `statement`，`reasoning_chain` 为空或仅有“权威说”式描述；
  - 几乎没有直接证据；
  - 不能作为高置信度输出，仅可作为提示/假说。

- **C1 初步链路**
  - 有若干推理步骤，但存在明显缺口：部分前提未溯源、规则描述模糊等；
  - 有有限证据支持（少量案例/二手数据）；
  - 可用于内部探索和候选方案，不建议直接驱动关键行为。

- **C2 逻辑自洽**
  - 推理链完整到可以被 LLM 或人类从头复走一遍；
  - 通过逻辑一致性检查：无明显自相矛盾，因果链连贯；
  - 至少一种证据集支持（实验/大量观测/高质量数据分析）；
  - 可作为一般行为决策依据，但对不可逆/高风险行为须叠加额外保障。

- **C3 高置信（不怀疑区）**
  - 满足 C2 条件，并同时具备：
    - 多次独立复查（不同时间段/不同数据来源/不同模型视角）；
    - 已知反例被明确限定在边界之外，或已通过模型修正处理；
  - 可进入“核心信念区”，用于长期稳定策略与高层判断的支撑。

#### 3.2 提升规则与权威作用

- **默认流程**：
  - 新导入结论 → 标记为 C0；
  - LLM/人类补充初步推理链 → 评估链路完整度与证据 → 升为 C1/C2；
  - 经反复验证和人类主脑/系统维护师审核 → 可升级为 C3。

- **权威的作用（authority_tags）**：
  - 影响：
    - 补链任务的优先级；
    - 所需证据强度（权威结论可优先被纳入“待补链集合”）。
  - 不直接影响 `confidence_level`，即：**权威只能决定“先查谁”，不能决定“谁是对的”。**

---

### 4. 系统行为规范：输出必须附带逻辑链

结合“结论输出必须附带完整逻辑链路”的项目规范，此处给出具体系统行为要求：

#### 4.1 面向用户/智能体的输出策略

- 当系统输出知识/结论时：
  - **若来自 C2/C3 推导体**：
    - 输出中必须包含：
      - 精简版推理链（至少列出关键前提与 3~7 步核心推导步骤）；
      - 明确提示“该结论可按请求展开详细推导”。
  - **若仅有 C0/C1 级支持**：
    - 必须显式标注为“暂疑/待验证观点”；
    - 描述当前推理进度：已知前提、缺失环节、依赖的外部公认结论；
    - 不使用“确定语气”包装为事实。

#### 4.2 内部行为决策规范

- 对于不可逆或高风险行为（如：写文件、修改配置、对外发送请求、资金相关操作等）：
  - 只能基于 C2/C3 级规则；
  - 若仅有 C0/C1 级规则可用：
    - 降级为“建议/候选方案”，需人类主脑明确批准或增加仿真/评估环节；
    - 行为日志中必须记录：当时使用的结论置信等级与链路摘要。

#### 4.3 防幻觉机制

- 系统层禁止以下情况：
  - 未附带任何推理链的结论，被标记为高置信度或用确定语气输出；
  - 仅凭权威标签，就将结论视为“铁律”。
- LLM 在回答时，若检测到链路不完整，应遵守：
  - 自动按“暂疑”语气输出；
  - 主动说明“逻辑链尚未补全到 C2”，并可提出“补链任务建议”。

---

### 5. 学习引擎与夜间维护：基于十二维的逻辑链补全

#### 5.1 记忆重构任务的语义升级

结合“记忆重构中逻辑链完整性补全机制”与“记忆更新时机策略”，对现有记忆重构任务做语义升级：

- **过去的重构**：
  - 主要在做“基于原数据补充/修正维度信息”（主题、事件、置信度标签等）。
- **升级后的重构**：
  - 在维度补全的基础上，增加明确目标：
    > 若检测到原始数据的逻辑链存在跳跃或不完整，必须主动利用现有能力（重构引擎、LLM、任务调度）对事件维进行**逻辑链补全**，尽可能将事件序列整理为“前提→中间推演→结论”的可复现路径。
  - 只有逻辑链在事件维上达到一定完整度的记忆条目，才允许置信度维度被提升到高等级（对应 C2/C3）。

#### 5.2 待补链任务与“切片检验员”

- LLM 切片检验员在日常对话/工具调用中，一旦发现：
  - 某段上下文的事件序列无法顺畅拼接成完整逻辑链；
  - 或结论与前文事件在因果上存在明显跳跃；
- 则应：
  - 生成“逻辑链补全泡泡”，记录：
    - 涉及的向量条目 ID；
    - 当前事件序列与缺口位置；
    - 初步补链建议（可为空）；
  - 将该泡泡写入夜间重构的任务池中，标记需要在“记忆重构每日一次”的定时任务中处理。

#### 5.3 夜间重构中的具体动作

在夜间（系统空闲时，按“记忆更新时机策略”），记忆重构任务具体做：

1. 扫描逻辑链状态为 `incomplete` 的向量条目，结合泡泡信息确定一批高优先级条目；
2. 对每个条目：
   - 利用原始对话/文档片段 + 事件维当前序列，调用 LLM，尝试：
     - 填补中间推导步骤；
     - 明确指出无法补全的缺口位置与原因；
   - 更新：
     - 事件维序列（必要时调整排序/合并/拆分事件）；
     - 逻辑链状态：`incomplete` → `partial`/`complete`；
     - 置信度维度：根据链路完整性与一致性适度上调或保持；
3. 将本次补链过程写入“泡泡”或日记，供后续审计与回溯。

> 重点：记忆重构仍然是“每日一次、在系统空闲时统一执行”的夜间任务，只是其内部逻辑从“补维度标签”为主，升级为“补事件维上的逻辑链”为核心之一。

---

### 6. 与现有架构的映射关系

#### 6.1 与统一记忆系统

- 在统一记忆数据库中：
  - 新增“推导体”存储结构（表或 JSON 文档集合）；
  - 对话与工具执行日志中，增加对 `proposition_id` 的可选引用，方便回溯“某个回答使用了哪条推导体”。

#### 6.2 与知识图谱构建模块

- 在 `mesh_database_interface` 中：
  - 节点由“简单知识点”升级为“推导体节点”，保留 `id/statement`，并可关联至完整推理结构；
  - 边类型增加：
    - `type: "premise_of"`（前提 → 结论）；
    - `type: "supports"`（证据 → 推导体）；
    - `type: "refutes"` 或 `"constrains"`（反例 → 约束/修正）。

- 在 `multi_layer_graph_manager` 中：
  - 支持按 `confidence_level` 过滤图谱视图；
  - 支持从任意结论节点反向追溯其推理链与证据链。

#### 6.3 与智能体与交互逻辑

- BaseAgent 与功能智能体：
  - 回答策略遵循第 4 节的输出规范；
  - 在需要高置信度回答时，仅从 C2/C3 推导体中选取知识；
  - LLM 切片检验员在检测逻辑链不完整时，按规范生成补链任务泡泡。

---

### 7. 建议的落地顺序（渐进式）

1. **文档与数据协议落地**（当前文件即为 v1 方案）：
   - 确认推导体结构与置信度分级规范；
   - 确认输出行为规范（结论必须附带逻辑链）。

2. **最小实现（MVP）**：
   - 在统一记忆中增加推导体的 JSON 存储（可仅人工创建或通过脚本从现有结论抽取）；
   - 在一个智能体的回答逻辑中试点：
     - 若有推导体，则附带精简推理链；
     - 若无推导体，则显式标记“暂疑/逻辑链未补全”。

3. **补链任务与夜间维护接入**：
   - 实现简单的待补链任务池与 LLM 补链泡泡生成；
   - 将补链泡泡写入 `data/memory_bubbles`，由系统维护师智能体做轻量审阅逻辑。

4. **图谱层集成（可选）**：
   - 在知识图谱构建时，将推导体及其关系映射为节点与边；
   - 提供按置信度过滤与追溯逻辑链的查询接口。

5. **长期演进**：
   - 对高频使用且 C0/C1 的结论优先补链；
   - 对 C2 级别结论按领域重要性逐步提升至 C3；
   - 按“主动不实现策略”，保持整体架构可演进、不过早固化。

---

### 8. 版本信息
- 版本：v1.2.0
- 变更：
  - 接入前置“主题归纳引擎工具”，在分片→向量化之前写入主题/事件维
  - 明确评估师智能体通过泡泡执行“主题归纳符合文本块特性”的评估任务
- 性质：规范性文档，指导后续实现与讨论；当前阶段不强制要求一次性代码落地。
